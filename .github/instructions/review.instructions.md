---
applyTo: '**'
name: General Review Instructions
description: Instructions for reviewing all types of files in the repository.
---

# レビューガイドライン
このファイルは、GitHub CopilotのAIエージェントがレビューを行う際のガイドラインを提供します。

## 一般原則
- レビューコメントは日本語で記述
- 各指摘に重要度ラベルを付与

## 重要度ラベル
| ラベル | 意味 | 対応                     |
|--------|------|------------------------|
| `[必須]` | マージすると大きな問題がある | 修正する |
| `[推奨]` | マージする前に修正したほうがよいことが明らか | 可能な限り対応するか、対応しない理由を説明する |
| `[任意]` | 上記以外の提案 | 対応は任意 |

## レビュー観点

### 必須
- **ランタイムエラー・クラッシュのリスク**: 未処理の例外、null安全性の欠如、境界値チェックの不足
- **失敗ケースの未ハンドリング**: エラー状態が適切に処理されていない（Rule 7: 失敗ケースの排除）
- **リソースリークの可能性**: メモリリーク、未クローズのリソース、コルーチンのキャンセル漏れ
- **セキュリティの脆弱性**: 入力検証の不足、機密情報の露出
- **テストなしの重要ロジック変更**: ビジネスロジックの変更に対するテストカバレッジの欠如

### 推奨
- **アーキテクチャ違反**: レイヤー分離（UI/Domain/Data）が守られていない、UDFパターンに従っていない
- **関心の分離不足**: ViewModelにAndroidフレームワーク依存がある、責務が混在している
- **不明確な命名**: 変数・関数・クラス名が処理内容を表していない（Rule 3: 命名は最良のドキュメント）
- **コードの重複**: DRY原則違反、同じロジックが複数箇所に存在
- **複雑すぎる条件分岐**: ネストが深い、boolean式が複雑
- **早すぎる汎化**: 1つのユースケースに対して過度に汎用的な設計（Rule 4: 3つの具体例まで待つ）
- **早すぎる最適化**: 計測なしのパフォーマンス最適化（Rule 5: 先に計測）
- **YAGNIの原則違反**: 現時点で不要な機能の実装
- **変数スコープが広すぎる**: クラスレベルの可変状態、グローバル変数の使用
- **フラグパラメータの使用**: booleanパラメータをenumやsealed classに置き換え可能
- **状態管理の問題**: StateFlow/SharedFlowの不適切な使用、状態の不整合

### 任意
- **より良い命名の提案**: 処理内容をより明確に表す名前への変更
- **リファクタリングの機会**: 単一責任原則に基づくクラス・関数の分割
- **可読性の向上**: コードの折りたたみ改善、複雑性の局所化（Rule 9, 10）
- **継承より合成への変更**: インターフェース委譲による柔軟な設計
- **完全修飾名の回避**: importを使用した簡潔な記述
- **Kotlinイディオムの活用**: スコープ関数、拡張関数の活用提案
- **コメントの追加・改善**: 複雑なビジネスロジックの説明

## コメント形式の例

```
[必須] ランタイムエラーが発生するリスクがあります。
エラーチェックを追加してください。
```

```
[推奨] この関数は分割することができます。
分岐のtrue部分とfalse部分を分割することで、テスタビリティが向上します。
```

```
[任意] `calculate` より `sum` の方が処理内容が明確です。
```

## レビュー時の心構え

- ユーザーの提案に対して一度は反論を思考し、建設的にフィードバックする
- いくつかの選択肢がある提案には根拠を示す
- 代替案を提示する
